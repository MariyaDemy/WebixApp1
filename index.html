<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webix First App</title>
    <script
      type="text/javascript"
      src="http://cdn.webix.com/edge/webix.js"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="http://cdn.webix.com/edge/webix.css"
    />
    <link rel="stylesheet" type="css" href="codebase/skins/material.css" />

    <style type="text/css">
      .webix_template {
        text-align: center;
      }
      .webix_list {
        background-color: rgb(233, 233, 236);
      }
      .greenLabel .webix_el_box {
        color: #138137;
        text-align: center;
        background-color: rgb(233, 233, 236);
      }
      .header {
        background-color: rgb(6 35 53 / 54%);
      }
      .webix_secondary .webix_button .webix_icon_btn {
        color: #fff;
      }
      .myBtn .webix_button,
      .myBtn .webix_button:hover,
      .myBtn .webix_button:focus,
      .myBtn .webix_button:active {
        color: #fff;
        background-color: inherit;
      }
      .myLabel .webix_el_box {
        color: #fff;
        font-size: 18px;
      }
      .gray {
        background-color: #f4f5f9;
      }
      .myhover.webix_cell {
        background: rgb(181, 228, 217);
      }
      .userslist .webix_list_item {
        display: flex;
        justify-content: space-between;
      }
      .highlight {
        background: rgb(181, 228, 217);
      }
    </style>
  </head>
  <body>
    <div id="my_link" style="display: none">
      The software is provided by
      <a href="https://webix.com" target="_blank">https://webix.com</a>. All
      rights reserved (c)
    </div>

    <script type="text/javascript" charset="utf-8">
      let header = {
        padding: 10,
        css: "header",
        cols: [
          { view: "label", label: "My App", css: "myLabel" },
          {
            view: "button",
            id: "profile",
            type: "icon",
            icon: "wxi-user",
            label: "Profile",
            maxWidth: 100,
            css: "myBtn",
            click: function () {
              if (!$$("popup").isVisible()) {
                $$("popup").show($$("profile").getNode(), {
                  pos: "bottom",
                  x: 0,
                  y: 5,
                });
              }
            },
          },
        ],
      };

      let list = {
        view: "list",
        scroll: false,
        maxWidth: 200,
        select: true,
        on: {
          onAfterSelect: function (id) {
            $$(id).show();
          },
        },
        ready: function () {
          const id = this.getFirstId();
          this.select(id);
        },
        data: ["Dashboard", "Users", "Products", "Admin"],
      };

      let label = {
        view: "label",
        label: "<span class='webix_icon wxi-check'></span> Connected",
        css: "greenLabel",
      };

      const valuesToForm = (id) => {
        let values = $$("mydata").getItem(id);
        $$("myform").setValues(values);
      };

      let datatable = {
        view: "datatable",
        id: "mydata",
        scrollX: false,
        scrollY: true,
        columns: [
          { id: "id", header: "", width: 50, css: "gray", sort: "int" },
          {
            id: "title",
            header: ["Film title", { content: "textFilter" }],
            fillspace: true,
            sort: "string",
          },
          {
            id: "year",
            header: ["Year", { content: "selectFilter" }],
            sort: "int",
          },
          {
            id: "votes",
            header: ["Votes", { content: "textFilter" }],
            sort: "int",
          },
          {
            id: "rating",
            header: ["Rating", { content: "textFilter" }],
            sort: "int",
          },
          {
            id: "rank",
            header: ["Rank", { content: "textFilter" }],
            sort: "int",
          },
          { id: "del", header: "", template: "{common.trashIcon()}" },
        ],
        onClick: {
          "wxi-trash": function (event, id) {
            this.remove(id);
            return false;
          },
        },
        url: "data.js",
        select: true,
        on: {
          onAfterSelect: valuesToForm,
        },
        hover: "myhover",
      };

      let today = new Date();

      let form = {
        view: "form",
        id: "myform",
        maxWidth: 300,
        elements: [
          { type: "section", template: "Edit Films" },
          {
            view: "text",
            label: "Title",
            height: 50,
            name: "title",
            invalidMessage: "Enter a title",
          },
          {
            view: "text",
            type: "number",
            label: "Year",
            height: 50,
            name: "year",
            invalidMessage: "Enter a year between 1970 and current",
          },
          {
            view: "text",
            label: "Rating",
            height: 50,
            name: "rating",
            invalidMessage: "Enter a number except 0",
          },
          {
            view: "text",
            label: "Votes",
            height: 50,
            name: "votes",
            invalidMessage: "Enter a number less than 100000",
          },
          {
            margin: 15,
            cols: [
              {
                view: "button",
                value: "Save",
                css: "webix_primary",
                click: function () {
                  const form = $$("myform");
                  const data = $$("mydata");
                  let values = form.getValues();
                  if (values.id) {
                    data.updateItem(values.id, values);
                  } else {
                    if (form.validate()) {
                      $$("mydata").add(values);
                      webix.message("The form is completed properly");
                    }
                  }
                },
              },
              {
                view: "button",
                value: "Clear",
                click: function () {
                  webix
                    .confirm({
                      title: "Form will be cleared",
                      text: "Do you still want to continue?",
                    })
                    .then(function () {
                      const form = $$("myform");
                      form.clear();
                      form.clearValidation();
                    });
                },
              },
            ],
          },
          { view: "spacer" },
        ],
        rules: {
          title: webix.rules.isNotEmpty,
          year: function (value) {
            return value >= 1970 && value <= today.getFullYear();
          },
          rating: function (value) {
            return value != 0 && webix.rules.isNotEmpty(value);
          },
          votes: function (value) {
            return value < 100000;
          },
        },
      };

      let toolbar = {
        view: "toolbar",
        cols: [
          {
            view: "text",
            id: "usersList_input",
            on: {
              onTimedKeyPress: function (id) {
                let value = this.getValue().toLowerCase();
                $$("usersList").filter("#name#", value);
              },
            },
          },

          {
            view: "button",
            value: "Sort asc",
            maxWidth: 100,
            css: "webix_primary",
            click: function () {
              $$("usersList").sort("#name#", "asc", "string");
            },
          },
          {
            view: "button",
            value: "Sort desc",
            maxWidth: 100,
            css: "webix_primary",
            click: function () {
              $$("usersList").sort("#name#", "desc", "string");
            },
          },
        ],
      };

      let usersList = {
        view: "list",
        id: "usersList",
        template:
          "#name# from #country# <span class='webix_icon wxi-close removeBtn'></span>",
        css: "userslist",
        url: "users.js",
        onClick: {
          removeBtn: function (event, id) {
            this.remove(id);
            return false;
          },
        },
        ready: function () {
          this.data.each(function (obj) {
            for (let i = 0; obj.id <= 5; i++) {
              $$("usersList").addCss(obj.id, "highlight");
              return false;
            }
          });
        },
      };

      let chart = {
        view: "chart",
        type: "bar",
        value: "#age#",
        xAxis: {
          template: "#age#",
          title: "Age",
        },
        url: "users.js",
      };

      let treetable = {
        view: "treetable",
        id: "treetable",
        select: "cell",
        columns: [
          { id: "id", header: "" },
          {
            id: "title",
            header: "Title",
            template: "{common.treetable()} #title#",
            fillspace: true,
          },
          {
            id: "price",
            header: "Price",
            fillspace: true,
          },
        ],
        scrollX: false,
        url: "products.js",
        ready: function () {
          this.openAll();
        },
      };

      let multiview = {
        view: "multiview",
        cells: [
          { id: "Dashboard", cols: [datatable, form] },
          { id: "Users", rows: [toolbar, usersList, chart] },
          { id: "Products", rows: [treetable] },
          { id: "Admin", template: "" },
        ],
      };

      let main = {
        cols: [{ rows: [list, label] }, { view: "resizer" }, multiview],
      };

      let footer = {
        rows: [{ view: "template", template: "html->my_link", height: 30 }],
      };

      webix.ui({
        view: "popup",
        id: "popup",
        body: {
          view: "list",
          data: ["Settings", "Log Out"],
          scroll: false,
          autoheight: true,
        },
      });

      webix.ui({
        rows: [header, main, footer],
      });
    </script>
  </body>
</html>
